<html>
<head>
</head>
<body>
<form id="myForm" action="javascript:testFunction()">
<table>
<tr>
<td>Deal Country : </td>
<td><input type="text" id="DealCountry" name="DealCountry" value="Canada"></td>
<td>Deal Date : </td>
<td><input type="text" id="DealDate" name="DealDate" value="2020"></td>
</tr>
<tr>
<td>Deal Stage : </td>
<td><input type="text" id="DealStage" name="DealStage" value="Unspecified Round"></td>
</tr>
<tr>
<td>Main Industry : </td>
<td><input type="text" id="MainIndustry" name="MainIndustry" value="Financial Services"></td>
<td>Detailed Industry : </td>
<td><input type="text" id="DetailedIndustry" name="DetailedIndustry" value="Accounting Services, Accounting/Finance Software, Analytics & Performance Software, Customer Relationship Management"></td>
</tr>
<tr>
<td>Industry Vertical : </td>
<td><input type="text" id="IndustryVertical" name="IndustryVertical" value="Cloud Computing, Deep Learning, FinTech, Financial Data, Machine Learning"></td>
<td>Your Currency : </td>
<td><input type="text" id="YourCurrency" name="YourCurrency" value="CAD"></td>
</tr>
<tr>
<td>Deal Size In Your Currency : </td>
<td><input type="text" id="DealSizeInYourCurrency" name="DealSizeInYourCurrency" value="20"></td>
<td>Deal Size In USD Only : </td>
<td><input type="text" id="DealSizeInUSDOnly" name="DealSizeInUSDOnly" value="15.29"></td>
</tr>
<tr>
<td>Company Incorporation Date : </td>
<td><input type="text" id="CompanyIncorporationDate" name="CompanyIncorporationDate" value="2010"></td>
</tr>
<tr>
<td>Company Revenue In Millions : </td>
<td><input type="text" id="CompanyRevenueInMillions" name="CompanyRevenueInMillions" value=""></td>
<td>EBITDA In Your Currency In Millions : </td>
<td><input type="text" id="EBITDAInYourCurrencyInMillions" name="EBITDAInYourCurrencyInMillions" value=""></td>
</tr>
<tr>

<td>Industry Classication : </td>
<td><input type="text" id="IndustryClassication" name="IndustryClassication" value="Financial & Insurance Services"></td>
</tr>
</table>
<button onclick="myFunction(false)" style="margin-left: 18%;margin-top: 1%;margin-bottom: 1%;">Show Data Here</button>
<button onclick="myFunction(true)">Download Data As CSV</button>
</form>
<div id="showData"></div>
<script>
function testFunction() { }
function myFunction(downloadFlag) {
    var xmlHttp = new XMLHttpRequest();
    var objJSON = {
        "DealCountry": document.forms['myForm'].elements['DealCountry'].value.trim(),
        "DealDate": document.forms['myForm'].elements['DealDate'].value.trim(),
        "DealStage": document.forms['myForm'].elements['DealStage'].value.trim(),
        "MainIndustry": document.forms['myForm'].elements['MainIndustry'].value.trim(),
        "DetailedIndustry": document.forms['myForm'].elements['DetailedIndustry'].value.trim(),
        "IndustryVertical": document.forms['myForm'].elements['IndustryVertical'].value.trim(),
        "YourCurrency": document.forms['myForm'].elements['YourCurrency'].value.trim(),
        "DealSizeInYourCurrency": document.forms['myForm'].elements['DealSizeInYourCurrency'].value.trim(),
        "DealSizeInUSDOnly": document.forms['myForm'].elements['DealSizeInUSDOnly'].value.trim(),
        "CompanyIncorporationDate": document.forms['myForm'].elements['CompanyIncorporationDate'].value.trim(),
        "CompanyRevenueInMillions": document.forms['myForm'].elements['CompanyRevenueInMillions'].value.trim(),
        "EBITDAInYourCurrencyInMillions": document.forms['myForm'].elements['EBITDAInYourCurrencyInMillions'].value.trim(),
        "IndustryClassication": document.forms['myForm'].elements['IndustryClassication'].value.trim(),
    };

    xmlHttp.open("GET", "https://api.akk.io/api?flow_key=8uVPEmgNNfRRQ9BhikHb%2F1&api_key=e75875eb-1060-4bbc-926b-4662af8649c5&sample=true&data=[" + encodeURIComponent(JSON.stringify(objJSON)) + "]", false);
    xmlHttp.send(null);
    var reponseJson = JSON.parse(xmlHttp.responseText);
    csvStr = '';

    var col = [];
    for (var i = 0; i < reponseJson.length; i++) {
        for (var key in reponseJson[i]) {
            if (col.indexOf(key) === -1) {
                col.push(key);
            }
        }
    }

    var table = document.createElement("table");
    table.style.cssText = 'border: 1px solid black;border-collapse: collapse;width:54%';

    for (var i = 0; i < reponseJson.length; i++) {
        for (var j = 0; j < col.length; j++) {
            var tr = document.createElement("tr");

            var td = document.createElement("td");
            td.style.cssText = 'border: 1px solid black;width: 60%;'
                td.innerHTML = col[j];

            csvStr += '"' + col[j] + '"' + ',';

            var td1 = document.createElement("td");
            td1.style.cssText = 'border: 1px solid black;'
                td1.innerHTML = reponseJson[i][col[j]];

            csvStr += '"' + reponseJson[i][col[j]] + '"' + "\r\n";

            tr.appendChild(td);
            tr.appendChild(td1);
            table.appendChild(tr);
        }
    }

    if (downloadFlag) {
        var hiddenElement = document.createElement('a');
        hiddenElement.href = 'data:text/csv;charset=utf-8,%EF%BB%BF' + encodeURI(csvStr);
        hiddenElement.target = '_blank';
        hiddenElement.download = 'output.csv';
        hiddenElement.click();
    } else {
        var divContainer = document.getElementById("showData");
        divContainer.innerHTML = "";
        divContainer.appendChild(table);
    }
}
</script>
</body>
</html>
