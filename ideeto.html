
        <html>  
        
        <style>
.myDiv {

  text-align: left;
  width: 200px;
  margin-left: 50px;
}

.progressBarLoader {
  border: 16px solid #f3f3f3;
  border-radius: 50%;
  border-top: 16px solid #3498db;
  width: 80px;
  height: 80px;
  -webkit-animation: spin 2s linear infinite; /* Safari */
  animation: spin 2s linear infinite;
  margin-left: 140%;
}

/* Safari */
@-webkit-keyframes spin {
  0% { -webkit-transform: rotate(0deg); }
  100% { -webkit-transform: rotate(360deg); }
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

</style>

<body>
<div class="myDiv">
<form id="myForm" action="javascript:testFunction()">
<table>
<tr>
  <td>Region      </td> 
  <td>
  <select input type="text" name="region" id="region">
   <option value="www">All countries</option>
   <option value="uk">United Kingdom</option>
   <option value="www">United States</option>
   <option value="ca">Canada</option>
   <option value="af">Afghanistan</option>
   <option value="al">Albania</option>
   <option value="dz">Algeria</option>
   <option value="ao">Angola</option>
   <option value="ar">Argentina</option>
   <option value="am">Armenia</option>
   <option value="aw">Aruba</option>
   <option value="au">Australia</option>
   <option value="at">Austria</option>
   <option value="bh">Bahrain</option>
   <option value="bd">Bangladesh</option>
   <option value="by">Belarus</option>
   <option value="be">Belgium</option>
   <option value="bz">Belize</option>
   <option value="bo">Bolivia</option>
   <option value="ba">Bosnia and Herzegovina</option>
   <option value="br">Brazil</option>
   <option value="bg">Bulgaria</option>
   <option value="cl">Chile</option>
   <option value="cn">China</option>
   <option value="co">Colombia</option>
   <option value="cr">Costa Rica</option>
   <option value="hr">Croatia</option>
   <option value="cy">Cyprus</option>
   <option value="cz">Czech Republic</option>
   <option value="dk">Denmark</option>
   <option value="dm">Dominica</option>
   <option value="do">Dominican Republic</option>
   <option value="ec">Ecuador</option>
   <option value="eg">Egypt</option>
   <option value="sv">El Salvador</option>
   <option value="ee">Estonia</option>
   <option value="fk">Falkland Islands</option>
   <option value="fi">Finland</option>
   <option value="fr">France</option>
   <option value="ge">Georgia</option>
   <option value="de">Germany</option>
   <option value="gh">Ghana</option>
   <option value="gi">Gibraltar</option>
   <option value="gr">Greece</option>
   <option value="gt">Guatemala</option>
   <option value="hk">Hong Kong</option>
   <option value="hu">Hungary</option>
   <option value="is">Iceland</option>
   <option value="in">India</option>
   <option value="id">Indonesia</option>
   <option value="ir">Iran</option>
   <option value="ie">Ireland</option>
   <option value="il">Israel</option>
   <option value="it">Italy</option>
   <option value="jm">Jamaica</option>
   <option value="jp">Japan</option>
   <option value="jo">Jordan</option>
   <option value="kz">Kazakhstan</option>
   <option value="ke">Kenya</option>
   <option value="kr">Korea</option>
   <option value="kw">Kuwait</option>
   <option value="la">Laos</option>
   <option value="lv">Latvia</option>
   <option value="lb">Lebanon</option>
   <option value="lu">Luxembourg</option>
   <option value="mk">Macedonia</option>
   <option value="my">Malaysia</option>
   <option value="mt">Malta</option>
   <option value="mx">Mexico</option>
   <option value="md">Moldova</option>
   <option value="mc">Monaco</option>
   <option value="me">Montenegro</option>
   <option value="ma">Morocco</option>
   <option value="mz">Mozambique</option>
   <option value="mm">Myanmar</option>
   <option value="np">Nepal</option>
   <option value="nl">Netherlands</option>
   <option value="nz">New Zealand</option>
   <option value="ng">Nigeria</option>
   <option value="no">Norway</option>
   <option value="om">Oman</option>
   <option value="pk">Pakistan</option>
   <option value="pa">Panama</option>
   <option value="pe">Peru</option>
   <option value="ph">Philippines</option>
   <option value="pl">Poland</option>
   <option value="pt">Portugal</option>
   <option value="pr">Puerto Rico</option>
   <option value="qa">Qatar</option>
   <option value="ro">Romania</option>
   <option value="ru">Russian Federation</option>
   <option value="st">Sao Tome and Principe</option>
   <option value="sa">Saudi Arabia</option>
   <option value="rs">Serbia</option>
   <option value="sg">Singapore</option>
   <option value="sk">Slovak Republic</option>
   <option value="si">Slovenia</option>
   <option value="za">South Africa</option>
   <option value="es">Spain</option>
   <option value="lk">Sri Lanka</option>
   <option value="se">Sweden</option>
   <option value="ch">Switzerland</option>
   <option value="tw">Taiwan</option>
   <option value="tz">Tanzania</option>
   <option value="th">Thailand</option>
   <option value="tg">Togo</option>
   <option value="to">Tonga</option>
   <option value="tt">Trinidad and Tobago</option>
   <option value="tn">Tunisia</option>
   <option value="tr">Turkey</option>
   <option value="ug">Uganda</option>
   <option value="ua">Ukraine</option>
   <option value="ae">United Arab Emirates</option>
   <option value="uy">Uruguay</option>
   <option value="uz">Uzbekistan</option>
   <option value="ve">Venezuela</option>
   <option value="vn">Vietnam</option>
   <option value="zw">Zimbabwe</option>
</select>
</td>
</tr>

<tr>
<td  style="width: 10px;">Key      </td>
<td><input type="text" id="apiKey" style="width: 600px;" name="apiKey" value="3f53a47c756bee09932e8d0f6fc19b0a610a28dedcb3ee1720d3400d2a60be5d" style="width: 500%;"></td> <br/>
</tr>

<tr>
<td>Lexicons      </td>
<td><input type="text" id="searchQuery"style="width: 600px;" name="searchQuery" value="&quot;series 67&quot; AND &quot;investment banking&quot;" style="width: 500%;"></td>
</tr>
</table>
<div class="progressBarLoader" id="progressBarId" style="display:none; margin-top:5%"></div>
<button onclick="submitFunction()" id="submitButtonId" style="margin-left: 155%;margin-top: 1%;margin-bottom: 5%;">Submit</button>
</form>
</div>
<p style="margin-left: 14%; display:none;" id="waitMessageId"><b>Please Wait.. Submitting and Processing .CSV File</b></p>
<p style="margin-left: 20%; display:none;" id="successMessageId"><b>.CSV has been processed</b></p>
<p style="margin-left: 22%; display:none;" id="errorMessageId"><b>Error occurred</b></p>
<br></br>
<script>

var csvStr = '';
var linkedinCsvStr = '';

function testFunction() {}

function enableProgressbar() {
    var progressBarId = document.getElementById("progressBarId");
    var submitButtonId = document.getElementById("submitButtonId");
    var waitMessageId = document.getElementById("waitMessageId");
    submitButtonId.style.display = "none";
    waitMessageId.style.display = "block";
    progressBarId.style.display = "block";
}

function submitFunction() {

    enableProgressbar();

    var apiKey = document.forms['myForm'].elements['apiKey'].value.trim();

    var region = document.forms['myForm'].elements['region'].value.trim();

    var locationAndWebsite = "site:" + region + ".linkedin.com/in -inurl:dir";
    var queryAlone = document.forms['myForm'].elements['searchQuery'].value.trim();
    var query = queryAlone.concat(locationAndWebsite);

    myFunction(1, query, apiKey, 1);
}

function myFunction(pageCount, query, apiKey, totalPageFlag) {

    var url = '';

    if (pageCount === 1) {
        url = 'https://serpapi.com/search.json?cc=ca&count=50&device=desktop&engine=bing&api_key=' + apiKey + "&q=" + encodeURIComponent(query);
    } else {
        url = 'https://serpapi.com/search.json?cc=ca&count=50&device=desktop&engine=bing&api_key=' + apiKey + "&first=" + pageCount + "&q=" + encodeURIComponent(query);
    }

    var csvStr1 = '';
	var linkedinCsvStr1 = '';
    var xmlHttp1 = new XMLHttpRequest();

    var handleRequestStateChange = function () {
        if (this.readyState == 4 && this.status == 200) {
            var progressBarId = document.getElementById("progressBarId");
            progressBarId.style.display = "block";

            jsonResponse1 = JSON.parse(this.responseText);

            if (pageCount === 1 && typeof jsonResponse1 !== 'undefined') {
                totalRecords = jsonResponse1.search_information.total_results;
            }

            if (typeof jsonResponse1 !== 'undefined' && typeof jsonResponse1['organic_results'] !== 'undefined' && jsonResponse1['organic_results'].length > 0) {
                for (i = 0; i < jsonResponse1['organic_results'].length; i++) {
                    result1 = jsonResponse1['organic_results'][i]['title'];
                    resultSplit1 = result1.split(" ");
                    var resultName1,
                    linkedinResult1,
                    snippetResult1 = '';
                    resultName1 = resultSplit1[0] + " " + resultSplit1[1];
                    linkedinResult1 = jsonResponse1['organic_results'][i]['link'];
                    snippetResult1 = jsonResponse1['organic_results'][i]['snippet'];
                    str = '"' + resultName1 + '"' + ',' + '"' + linkedinResult1 + '"' + ',' + '"' + snippetResult1.replace(/#/g, "") + '"';
					linkedinStr = '"' + linkedinResult1 + '"';
                    csvStr1 += str + "\r\n";
					linkedinCsvStr1 += linkedinStr + "\r\n";
                }
            }
            valueCallBack(csvStr1, pageCount, totalRecords, query, apiKey, linkedinCsvStr1);
        } else if (this.status !== 200) {
			showErrorMessage();
		}
    }

    xmlHttp1.open("GET", url, true);
    xmlHttp1.onreadystatechange = handleRequestStateChange;
    xmlHttp1.setRequestHeader('Access-Control-Allow-Origin', '*');
    xmlHttp1.setRequestHeader('X-Requested-With', 'XMLHttpRequest');
    xmlHttp1.send(null);
}

function valueCallBack(csvStr1, pageCount, totalPageFlag, query, apiKey, linkedinCsvStr1) {

    if (pageCount === 1) {
        var columnName = ["Name", "Linkedin URL", "Snippet Result"];
        csvStr = columnName.join(",") + "\n";
		
		var linkedinColumnName = ["Linkedin URL"];
        linkedinCsvStr = linkedinColumnName.join(",") + "\n";
    }

    csvStr += csvStr1;
	linkedinCsvStr += linkedinCsvStr1;

    if ((pageCount === 1 && totalPageFlag <= 50) || pageCount > totalPageFlag) {
        downloadCsv(csvStr);
		downloadLinkedinCsv(linkedinCsvStr);
		var successMessageId = document.getElementById("successMessageId");
		successMessageId.style.display = "block";
		setTimeout(function(){
			successMessageId.innerHTML = '';
		}, 4000);
    } else {
        pageCnt = 50 + pageCount;
        csvStr1 = myFunction(pageCnt, query, apiKey, totalPageFlag);
    }
}

function showErrorMessage() {
	var progressBarId = document.getElementById("progressBarId");
    var submitButtonId = document.getElementById("submitButtonId");
    var waitMessageId = document.getElementById("waitMessageId");
	var errorMessageId = document.getElementById("errorMessageId");
    errorMessageId.style.display = "block";	
	submitButtonId.style.display = "block";
    waitMessageId.style.display = "none";
    progressBarId.style.display = "none";
	setTimeout(function(){
		errorMessageId.innerHTML = '';
	}, 4000);
}

function downloadCsv(csvStr) {
    var hiddenElement = document.createElement('a');
    hiddenElement.href = 'data:text/csv;charset=utf-8,%EF%BB%BF' + encodeURI(csvStr);
    hiddenElement.target = '_blank';
    hiddenElement.download = 'Output.csv';
    hiddenElement.click();
}

function downloadLinkedinCsv(linkedinCsvStr) {
    var hiddenElement = document.createElement('a');
    hiddenElement.href = 'data:text/csv;charset=utf-8,%EF%BB%BF' + encodeURI(linkedinCsvStr);
    hiddenElement.target = '_blank';
    hiddenElement.download = 'LinkedInUrlsOutput.csv';
    hiddenElement.click();
    var progressBarId = document.getElementById("progressBarId");
    var submitButtonId = document.getElementById("submitButtonId");
    var waitMessageId = document.getElementById("waitMessageId");
    submitButtonId.style.display = "block";
    waitMessageId.style.display = "none";
    progressBarId.style.display = "none";
    alert("Output.csv & LinkedInUrlsOutput.csv has been generated");
}

</script>  
</body>
</html>
